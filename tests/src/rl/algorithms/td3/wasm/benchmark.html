<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WASM Struct Example</title>
</head>
<body>
<script type="module">
    import createBackpropToolsInterface from './wasm_interface.js';
    createBackpropToolsInterface().then((bpt) => {
        const create_training_state = bpt._proxy_create_training_state;
        const training_step = bpt._proxy_training_step;
        const destroy_training_state = bpt._proxy_destroy_training_state;

        const ts = create_training_state();
        let finished = false;
        let timer = setInterval(() => {
            let step = bpt._proxy_get_step(ts);
            if(step % 100 == 0){
                console.log("step " + step);
            }
            finished = training_step(ts);
            if(finished){
                clearInterval(timer);
                let num_evaluations = bpt._proxy_get_evaluation_count();
                for(let i = 0; i < num_evaluations; i++){
                    let evaluation_return = bpt._proxy_get_evaluation_return(ts, i);
                    console.log("evaluation return[" + i + "]: " + evaluation_return);
                }
                destroy_training_state(ts);
            }
        }, 1);
    })
</script>
</body>
</html>